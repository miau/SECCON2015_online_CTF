FROM debian:jessie
MAINTAINER iwamura

# Modify sources.list for using mirror site
RUN (echo deb http://cdn.debian.net/debian jessie main; \
     echo deb http://cdn.debian.net/debian jessie-updates main; \
     echo deb http://security.debian.org jessie/updates main) > /etc/apt/sources.list

# Install packages
RUN apt-get update && apt-get -y --no-install-recommends install \
	locales \
        build-essential \
        xinetd \
        python \
        vim-nox \
        sudo \
        strace \
        gdb \
    &&\
    rm -r /var/cache/apt /var/lib/apt/lists

# Setup Japanese locale
RUN echo "ja_JP.UTF-8 UTF-8" > /etc/locale.gen && \
    locale-gen && \
    update-locale LANG=ja_JP.UTF-8
ENV LANG ja_JP.UTF-8
ENV LANGUAGE ja_JP.UTF-8
ENV LC_ALL ja_JP.UTF-8

# Create user and working directory to build
RUN useradd treewalker &&\
    echo "treewalker ALL=(ALL:ALL) NOPASSWD: ALL" > /etc/sudoers.d/treewalker &&\
    mkdir -p /opt/treewalker-root && chown treewalker.treewalker /opt/treewalker-root
USER treewalker

# Create root directory for chroot
RUN cd /opt/treewalker-root &&\
    mkdir -p bin lib/x86_64-linux-gnu lib64 &&\
    for f in libc.so.6; \
        do cp /lib/x86_64-linux-gnu/$f lib/x86_64-linux-gnu; \
    done &&\
    cp /lib64/ld-linux-x86-64.so.2 lib64

ADD make-all.sh /opt/

#CMD ["xinetd", "-dontfork"]
CMD ["/bin/bash"]

