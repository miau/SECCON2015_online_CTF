#include <stdio.h>

int main()
{
    unsigned long   addr; 
    unsigned int    status[7];
    int i;
    unsigned char   fxstatus[512];

    printf("main   : %016llx\n", main);


    __asm__ volatile ("leaq (%%rip), %0":"=r"(addr));
    printf("LEA    : %016llx\n", addr);

    __asm__ volatile ("fnop; fnstenv %0":"=m"(status));
    printf("FNSTENV: %08x\n", status[3]);
    /*
    printf("[table]\n");
    for(i=0;i < sizeof(status)/sizeof(status[0]);i++){
        printf("%02d: %08x\n",i, status[i]);
    }
    */

    __asm__ volatile ("fxsave64 %0":"=m"(fxstatus));
    printf("FXSAVE : %016llx\n", *(unsigned long*)&fxstatus[8]);
    /*
    for(i = 0; i < sizeof(fxstatus); i++){
        printf("%02x", fxstatus[i]);
        if((i%16)==15){
            printf("\n");
        }else{
            printf(" ");
        }
    }
    */


    getchar();

    return 0;
}
